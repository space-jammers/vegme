<script src="https://use.fontawesome.com/fb33a1c2bd.js"></script>

<!-- Search Form -->
<div>
  <%= form_tag(search_path, :method=>'post') do %>
    <div>
     Search Term:<br />
     <%= text_field_tag "q",
       QueryResult.return_query_term,
       maxlength: 20,
       placeholder: 'Search',
       required: true
     %>
    </div>
     <div>
       Vegan <%= radio_button_tag(:health, "vegan", QueryResult.return_health == 'vegetarian' ? false : true) %>
       <br />
       Vegetarian <%= radio_button_tag(:health, "vegetarian", QueryResult.return_health == 'vegetarian' ? true : false) %>
       <br />
     </div>
        <div>
          Maximum Calories Per Serving:
          <br/>
          <%= number_field_tag "max_cal",
                                QueryResult.return_max_cal ? QueryResult.return_max_cal : 500,
                                min:1,
                                required: true %>
        </div>
     <div>
       <%= submit_tag 'Submit' %>
     </div>
  <% end %>
</div>

<br /><br />

<!-- Query Results -->
<% if @recipes %>
  <div class='row'>
    <div class="small-12 columns recipe-container">
      <% @recipes.each do |recipe| %>
        <% recipe = recipe.make_dto %>
        <div class="recipe-query-box">
          <%= image_tag(recipe.image) %>
          <br /><br />
          <%= recipe.label %>
          <br /><br />
          <% if current_user %>
          <!-- Favorite/Dashboard Buttons -->
          <div id="change-favorites-<%=recipe.e_id %>">
            <% if Recipe.exists?(edamam_id: recipe.e_id) %>
              <%= link_to dashboard_url, class: 'button',
                                         data: { button_id: recipe.e_id },
                                         method: :get do %>
                    View Dashboard
                    <% if Recipe.exists?(edamam_id: recipe.e_id, dislike: true) %>
                      <i class="fa fa-thumbs-down"></i>
                    <% else %>
                      <i class="fa fa-heart"></i>
                    <%end%>
              <% end %>
            <% else %>
              <%= link_to user_recipes_path(user_id: current_user.id,
                                            id: recipe.e_id,
                                            recipe_name: recipe.label,
                                            dislike: false ),
                                            class: 'button fav',
                                            data: { button_id: recipe.e_id },
                                            method: :post do %>
                                            <i class="fa fa-heart-o"></i>
              <% end %>
              <%= link_to user_recipes_path(user_id: current_user.id,
                                            id: recipe.e_id,
                                            recipe_name: recipe.label,
                                            dislike: true ),
                                            class: 'button dislike',
                                            method: :post do %>
                                            <i class="fa fa-thumbs-o-down"></i>
              <% end %>
            <% end %>
          </div>
          <% else %>
            <%= button_to 'Sign In to Save', new_user_session_path, class: 'button' %>
          <% end %>
          Servings: <%= recipe.yield %>
          <br />
          Calories per Serving: <%= (recipe.calories/recipe.yield).round %>
          <br /><br />
          Ingredients:
          <% recipe.ingredient_list.each do |ingredient| %>
            <br />
            <%= ingredient %>
          <% end %>
          <br /><br />
          <%= link_to 'See Directions', recipe.url, target: '_blank', class:'button', method: :get %>
        </div>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="small-12 columns text-center">
      <%= will_paginate @recipes %>
    </div>
  </div>
<% end %>
