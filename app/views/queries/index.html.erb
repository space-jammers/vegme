<script src="https://use.fontawesome.com/fb33a1c2bd.js"></script>

<div>
  <%= form_tag(search_path, :method=>'post') do %>
    <div>
     Search Term:<br />
     <%= text_field_tag "q",
       QueryResult.return_query_term,
       maxlength: 20,
       placeholder: 'Search',
       required: true
     %>
    </div>
    <div>
      Number of Results:
      <br />
      <%= number_field_tag "limit",
                            QueryResult.return_limit,
                            min:1,
                            max:10,
                            required: true %>
    </div>
     <div>
       Vegan <%= radio_button_tag(:health, "vegan", true) %>
       <br />
       Vegetarian <%= radio_button_tag(:health, "vegetarian") %>
       <br />
     </div>
        <div>
          Maximum Calories Per Serving:
          <br/>
          <%= number_field_tag "max_cal",
                                QueryResult.return_max_cal,
                                min:1,
                                required: true %>
        </div>
     <div>
       <%= submit_tag 'Submit' %>
     </div>
  <% end %>
</div>
<br /><br />
<% if @recipes %>
  <% @recipes.each do |recipe| %>
    <% recipe = recipe.make_dto %>
      <div class="recipe-query-box">
        <%= image_tag(recipe.image) %>
        <br /><br />
        <%= recipe.label %>
        <br /><br />
        <% if current_user %>
          <% if Recipe.exists?(edamam_id: recipe.e_id) %>
            <%= button_to dashboard_url, class: 'button', method: :get do %>
              View Dashboard
              <% if Recipe.exists?(edamam_id: recipe.e_id, dislike: true) %>
                <i class="fa fa-thumbs-down"></i>
              <% else %>
                <i class="fa fa-heart"></i>
              <%end%>
            <% end %>
          <% else %>
            <%= button_to user_recipes_path(user_id: current_user.id,
                                            id: recipe.e_id,
                                            recipe_name: recipe.label,
                                            dislike: false ),
                                            class: 'button',
                                            method: :post do %>
              <i class="fa fa-heart-o"></i>
            <% end %>
            <%= button_to user_recipes_path(user_id: current_user.id,
                                            id: recipe.e_id,
                                            recipe_name: recipe.label,
                                            dislike: true ),
                                            class: 'button',
                                            method: :post do %>
              <i class="fa fa-thumbs-o-down"></i>
            <% end %>
          <% end %>
        <% else %>
        <%= button_to 'Sign In to Save', new_user_session_path, class: 'button' %>
        <% end %>
        Servings: <%= recipe.yield %>
        <br />
        Calories per Serving: <%= (recipe.calories/recipe.yield).round(1) %>
        <br /><br />
        Ingredients:
        <% recipe.ingredient_list.each do |ingredient| %>
          <br />
          <%= ingredient %>
        <% end %>
        <br /><br />
        <%= link_to 'See Directions', recipe.url, target: '_blank', class:'button', method: :get %>
      </div>
      <br /><br />
    <% end %>
<% end %>
